import styled from '@emotion/styled'
import { SearchBar } from '../form/SearchBar'
import { MultipleSelect, MultipleSelectOption } from '../form/MultipleSelect'
import { LogLevel } from '@fullstack-devtool/core'
import { useFilters } from '../../stores/useFilters'
import { useMessageStore } from '../../stores/messageStore'
import { useMemo } from 'react'

const levelOptions: MultipleSelectOption[] = [
  {
    label: 'Debug',
    value: LogLevel.DEBUG,
    logo: (
      <svg width="12" height="15" viewBox="0 0 12 15" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M4.5 6.75C4.5 6.55109 4.57902 6.36032 4.71967 6.21967C4.86032 6.07902 5.05109 6 5.25 6H6.75C6.94891 6 7.13968 6.07902 7.28033 6.21967C7.42098 6.36032 7.5 6.55109 7.5 6.75C7.5 6.94891 7.42098 7.13968 7.28033 7.28033C7.13968 7.42098 6.94891 7.5 6.75 7.5H5.25C5.05109 7.5 4.86032 7.42098 4.71967 7.28033C4.57902 7.13968 4.5 6.94891 4.5 6.75ZM5.25 9C5.05109 9 4.86032 9.07902 4.71967 9.21967C4.57902 9.36032 4.5 9.55109 4.5 9.75C4.5 9.94891 4.57902 10.1397 4.71967 10.2803C4.86032 10.421 5.05109 10.5 5.25 10.5H6.75C6.94891 10.5 7.13968 10.421 7.28033 10.2803C7.42098 10.1397 7.5 9.94891 7.5 9.75C7.5 9.55109 7.42098 9.36032 7.28033 9.21967C7.13968 9.07902 6.94891 9 6.75 9H5.25Z"
          fill="black"
        />
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M3.8205 2.0625C3.29244 1.50578 2.99867 0.767323 3 0H4.5C4.5 0.397825 4.65804 0.779356 4.93934 1.06066C5.22064 1.34196 5.60218 1.5 6 1.5C6.39782 1.5 6.77936 1.34196 7.06066 1.06066C7.34196 0.779356 7.5 0.397825 7.5 0H9C9.00133 0.767323 8.70756 1.50578 8.1795 2.0625C9.14179 2.59624 9.87603 3.46304 10.2443 4.5H11.25C11.4489 4.5 11.6397 4.57902 11.7803 4.71967C11.921 4.86032 12 5.05109 12 5.25C12 5.44891 11.921 5.63968 11.7803 5.78033C11.6397 5.92098 11.4489 6 11.25 6H10.5V7.5H11.25C11.4489 7.5 11.6397 7.57902 11.7803 7.71967C11.921 7.86032 12 8.05109 12 8.25C12 8.44891 11.921 8.63968 11.7803 8.78033C11.6397 8.92098 11.4489 9 11.25 9H10.5V10.5H11.25C11.4489 10.5 11.6397 10.579 11.7803 10.7197C11.921 10.8603 12 11.0511 12 11.25C12 11.4489 11.921 11.6397 11.7803 11.7803C11.6397 11.921 11.4489 12 11.25 12H10.2443C9.93385 12.8777 9.35899 13.6376 8.59883 14.1751C7.83867 14.7125 6.9306 15.0011 5.99963 15.0011C5.06866 15.0011 4.16058 14.7125 3.40042 14.1751C2.64026 13.6376 2.0654 12.8777 1.755 12H0.75C0.551088 12 0.360322 11.921 0.21967 11.7803C0.0790178 11.6397 0 11.4489 0 11.25C0 11.0511 0.0790178 10.8603 0.21967 10.7197C0.360322 10.579 0.551088 10.5 0.75 10.5H1.5V9H0.75C0.551088 9 0.360322 8.92098 0.21967 8.78033C0.0790178 8.63968 0 8.44891 0 8.25C0 8.05109 0.0790178 7.86032 0.21967 7.71967C0.360322 7.57902 0.551088 7.5 0.75 7.5H1.5V6H0.75C0.551088 6 0.360322 5.92098 0.21967 5.78033C0.0790178 5.63968 0 5.44891 0 5.25C0 5.05109 0.0790178 4.86032 0.21967 4.71967C0.360322 4.57902 0.551088 4.5 0.75 4.5H1.75575C2.12397 3.46304 2.85821 2.59624 3.8205 2.0625ZM3 10.5V6C3 5.20435 3.31607 4.44129 3.87868 3.87868C4.44129 3.31607 5.20435 3 6 3C6.79565 3 7.55871 3.31607 8.12132 3.87868C8.68393 4.44129 9 5.20435 9 6V10.5C9 11.2956 8.68393 12.0587 8.12132 12.6213C7.55871 13.1839 6.79565 13.5 6 13.5C5.20435 13.5 4.44129 13.1839 3.87868 12.6213C3.31607 12.0587 3 11.2956 3 10.5Z"
          fill="black"
        />
      </svg>
    ),
  },
  {
    label: 'Info',
    value: LogLevel.INFO,
    logo: (
      <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M7 14C6.08075 14 5.1705 13.8189 4.32122 13.4672C3.47194 13.1154 2.70026 12.5998 2.05025 11.9497C1.40024 11.2997 0.884626 10.5281 0.532843 9.67878C0.18106 8.8295 0 7.91925 0 7C0 6.08075 0.18106 5.1705 0.532843 4.32122C0.884626 3.47194 1.40024 2.70026 2.05025 2.05025C2.70026 1.40024 3.47194 0.884626 4.32122 0.532843C5.1705 0.18106 6.08075 -1.36979e-08 7 0C8.85652 2.76642e-08 10.637 0.737498 11.9497 2.05025C13.2625 3.36301 14 5.14348 14 7C14 8.85652 13.2625 10.637 11.9497 11.9497C10.637 13.2625 8.85652 14 7 14ZM7 3.11111C6.79372 3.11111 6.59589 3.19306 6.45003 3.33892C6.30417 3.48478 6.22222 3.68261 6.22222 3.88889C6.22222 4.09517 6.30417 4.293 6.45003 4.43886C6.59589 4.58472 6.79372 4.66667 7 4.66667H7.00778C7.21406 4.66667 7.41189 4.58472 7.55775 4.43886C7.70361 4.293 7.78556 4.09517 7.78556 3.88889C7.78556 3.68261 7.70361 3.48478 7.55775 3.33892C7.41189 3.19306 7.21406 3.11111 7.00778 3.11111H7ZM5.83333 6.22222C5.62705 6.22222 5.42922 6.30417 5.28336 6.45003C5.1375 6.59589 5.05556 6.79372 5.05556 7C5.05556 7.20628 5.1375 7.40411 5.28336 7.54997C5.42922 7.69583 5.62705 7.77778 5.83333 7.77778H6.22222V10.1111C6.22222 10.3174 6.30417 10.5152 6.45003 10.6611C6.59589 10.8069 6.79372 10.8889 7 10.8889H8.55556C8.76184 10.8889 8.95967 10.8069 9.10553 10.6611C9.25139 10.5152 9.33333 10.3174 9.33333 10.1111C9.33333 9.90483 9.25139 9.707 9.10553 9.56114C8.95967 9.41528 8.76184 9.33333 8.55556 9.33333H7.77778V7C7.77778 6.79372 7.69583 6.59589 7.54997 6.45003C7.40411 6.30417 7.20628 6.22222 7 6.22222H5.83333Z"
          fill="#3A71FF"
        />
      </svg>
    ),
  },
  {
    label: 'Warn',
    value: LogLevel.WARN,
    logo: (
      <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M12.8872 10.8632C10.9779 7.37544 9.06792 3.88769 7.1583 0.399938C7.09462 0.279235 6.9992 0.178199 6.88234 0.107723C6.76547 0.0372457 6.63159 0 6.49511 0C6.35864 0 6.22476 0.0372457 6.10789 0.107723C5.99103 0.178199 5.89561 0.279235 5.83193 0.399938C3.92252 3.88769 2.01147 7.37544 0.103071 10.8632C-0.192421 11.4019 0.184215 12.1003 0.765643 12.1003H12.2254C12.5475 12.1003 12.7639 11.9268 12.8768 11.6915C13.0187 11.4674 13.0568 11.1699 12.888 10.8628"
          fill="#FFDD15"
        />
        <path
          d="M5.88048 6.99048L5.69969 4.29342C5.66593 3.76813 5.64966 3.39068 5.64966 3.16168C5.64966 2.84972 5.73101 2.6071 5.89411 2.432C6.05782 2.25792 6.27298 2.17047 6.5398 2.17047C6.86173 2.17047 7.07791 2.28253 7.1861 2.50521C7.29531 2.72933 7.35062 3.05105 7.35062 3.47141C7.35062 3.7185 7.3372 3.97027 7.31036 4.2255L7.06835 7.00126C7.04212 7.33194 6.98619 7.58533 6.90016 7.76165C6.81353 7.93879 6.67077 8.02623 6.47126 8.02623C6.26952 8.02623 6.12757 7.94102 6.04989 7.7706C5.96996 7.59957 5.91404 7.33946 5.88048 6.99048ZM6.50523 10.6952C6.27644 10.6952 6.07693 10.6216 5.9059 10.4729C5.73487 10.3249 5.64966 10.1175 5.64966 9.85105C5.64966 9.6186 5.73101 9.41991 5.89411 9.25702C6.05782 9.0931 6.25732 9.01175 6.49424 9.01175C6.73117 9.01175 6.93209 9.0931 7.09967 9.25702C7.26541 9.41991 7.35062 9.6186 7.35062 9.85105C7.35062 10.1134 7.26541 10.3204 7.09723 10.4701C6.93554 10.6174 6.72396 10.6979 6.50523 10.6952Z"
          fill="#1F2E35"
        />
      </svg>
    ),
  },
  {
    label: 'Error',
    value: LogLevel.ERROR,
    logo: (
      <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M7 0C3.136 0 0 3.136 0 7C0 10.864 3.136 14 7 14C10.864 14 14 10.864 14 7C14 3.136 10.864 0 7 0ZM7.7 10.5H6.3V9.1H7.7V10.5ZM7.7 7.7H6.3V3.5H7.7V7.7Z"
          fill="#FF1F1F"
        />
      </svg>
    ),
  },
  {
    label: 'Log',
    value: LogLevel.LOG,
    logo: (
      <svg width="13" height="7" viewBox="0 0 13 7" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path
          d="M0.722222 4.2C1.11944 4.2 1.44444 3.885 1.44444 3.5C1.44444 3.115 1.11944 2.8 0.722222 2.8C0.325 2.8 0 3.115 0 3.5C0 3.885 0.325 4.2 0.722222 4.2ZM0.722222 7C1.11944 7 1.44444 6.685 1.44444 6.3C1.44444 5.915 1.11944 5.6 0.722222 5.6C0.325 5.6 0 5.915 0 6.3C0 6.685 0.325 7 0.722222 7ZM0.722222 1.4C1.11944 1.4 1.44444 1.085 1.44444 0.7C1.44444 0.315 1.11944 0 0.722222 0C0.325 0 0 0.315 0 0.7C0 1.085 0.325 1.4 0.722222 1.4ZM3.61111 4.2H12.2778C12.675 4.2 13 3.885 13 3.5C13 3.115 12.675 2.8 12.2778 2.8H3.61111C3.21389 2.8 2.88889 3.115 2.88889 3.5C2.88889 3.885 3.21389 4.2 3.61111 4.2ZM3.61111 7H12.2778C12.675 7 13 6.685 13 6.3C13 5.915 12.675 5.6 12.2778 5.6H3.61111C3.21389 5.6 2.88889 5.915 2.88889 6.3C2.88889 6.685 3.21389 7 3.61111 7ZM2.88889 0.7C2.88889 1.085 3.21389 1.4 3.61111 1.4H12.2778C12.675 1.4 13 1.085 13 0.7C13 0.315 12.675 0 12.2778 0H3.61111C3.21389 0 2.88889 0.315 2.88889 0.7ZM0.722222 4.2C1.11944 4.2 1.44444 3.885 1.44444 3.5C1.44444 3.115 1.11944 2.8 0.722222 2.8C0.325 2.8 0 3.115 0 3.5C0 3.885 0.325 4.2 0.722222 4.2ZM0.722222 7C1.11944 7 1.44444 6.685 1.44444 6.3C1.44444 5.915 1.11944 5.6 0.722222 5.6C0.325 5.6 0 5.915 0 6.3C0 6.685 0.325 7 0.722222 7ZM0.722222 1.4C1.11944 1.4 1.44444 1.085 1.44444 0.7C1.44444 0.315 1.11944 0 0.722222 0C0.325 0 0 0.315 0 0.7C0 1.085 0.325 1.4 0.722222 1.4ZM3.61111 4.2H12.2778C12.675 4.2 13 3.885 13 3.5C13 3.115 12.675 2.8 12.2778 2.8H3.61111C3.21389 2.8 2.88889 3.115 2.88889 3.5C2.88889 3.885 3.21389 4.2 3.61111 4.2ZM3.61111 7H12.2778C12.675 7 13 6.685 13 6.3C13 5.915 12.675 5.6 12.2778 5.6H3.61111C3.21389 5.6 2.88889 5.915 2.88889 6.3C2.88889 6.685 3.21389 7 3.61111 7ZM2.88889 0.7C2.88889 1.085 3.21389 1.4 3.61111 1.4H12.2778C12.675 1.4 13 1.085 13 0.7C13 0.315 12.675 0 12.2778 0H3.61111C3.21389 0 2.88889 0.315 2.88889 0.7Z"
          fill="black"
        />
      </svg>
    ),
  },
]

const Container = styled.div`
  display: flex;
  align-items: center;
  padding: ${(props) => props.theme.margin.small} ${(props) => props.theme.margin.medium};
  border-top: 1px solid ${(props) => props.theme.colors.border};
`

const SearchContainer = styled.div`
  flex: 3;
`

const SelectContainer = styled.div`
  flex: 1;
  display: flex;
  align-items: center;
`

const SelectWrapper = styled.div`
  border-left: 1px solid ${(props) => props.theme.colors.border};
  padding-left: ${(props) => props.theme.margin.medium};
  padding-right: ${(props) => props.theme.margin.medium};
`

export function Filters() {
  const { selectedLevels, toggleLevel, selectedSources, toggleSource, search, setSearch } = useFilters((state) => ({
    selectedLevels: state.selectedLevels,
    toggleLevel: state.toggleLevel,
    selectedSources: state.selectedSources,
    toggleSource: state.toggleSource,
    search: state.search,
    setSearch: state.setSearch,
  }))
  const sources = useMessageStore((state) => state.sources)
  const tags = useMessageStore((state) => state.tags)

  const sourceOptions = useMemo(() => {
    return sources.map((source) => ({
      label: source,
      value: source,
    }))
  }, [sources])

  const tagOptions = useMemo(() => {
    return tags.map((tag) => ({
      label: tag,
      value: tag,
    }))
  }, [])

  return (
    <Container>
      <SearchContainer>
        <SearchBar search={search} onChange={setSearch} />
      </SearchContainer>
      <SelectContainer>
        <SelectWrapper>
          <MultipleSelect
            label={'Levels'}
            options={levelOptions}
            values={selectedLevels}
            valuesAsLabel
            onChange={toggleLevel}
            style={{ width: '130px', height: '30px' }}
          />
        </SelectWrapper>
        <SelectWrapper>
          <MultipleSelect label="Sources" options={sourceOptions} values={selectedSources} onChange={toggleSource} />
        </SelectWrapper>
        <SelectWrapper>
          <MultipleSelect label="Tags" options={tagOptions} values={selectedSources} onChange={toggleSource} />
        </SelectWrapper>
      </SelectContainer>
    </Container>
  )
}
